<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medication Tracker</title>
    <link rel="manifest" href="manifest.json">
    <style>
        body {
            font-family: system-ui;
            margin: 0;
            padding: 16px;
            background: #f4f6fa;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        h2 {
            margin-top: 0
        }

        input,
        button {
            padding: 8px;
            margin: 5px 0;
            width: 100%;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th,
        td {
            padding: 8px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        button {
            background: #4f46e5;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div class="card">
        <h2>Settings</h2>

        <label>Medication After Lunch Name</label>
        <input id="medLunch">

        <label>Medication After Dinner Name</label>
        <input id="medDinner">

        <label>Lunch Reminder Time</label>
        <input type="time" id="timeLunch">

        <label>Dinner Reminder Time</label>
        <input type="time" id="timeDinner">

        <label>Start Date</label>
        <input type="date" id="startDate">

        <button onclick="saveSettings()">Save Settings</button>
        <button onclick="requestNotif()">Enable Notifications</button>
    </div>

    <div class="card">
        <h2>Today</h2>
        <div id="today"></div>
        <label><input type="checkbox" id="checkLunch"> Lunch Taken</label><br>
        <label><input type="checkbox" id="checkDinner"> Dinner Taken</label>
    </div>

    <div class="card">
        <h2>History</h2>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Lunch</th>
                    <th>Dinner</th>
                </tr>
            </thead>
            <tbody id="history"></tbody>
        </table>
    </div>

    <script>
        const SETTINGS_KEY = "medSettings";
        const DATA_KEY = "medData";

        let settings = JSON.parse(localStorage.getItem(SETTINGS_KEY)) || {};
        let data = JSON.parse(localStorage.getItem(DATA_KEY)) || {};

        function saveSettings() {
            settings = {
                medLunch: medLunch.value,
                medDinner: medDinner.value,
                timeLunch: timeLunch.value,
                timeDinner: timeDinner.value,
                startDate: startDate.value
            };
            localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
            alert("Saved");
        }

        function formatDate(d) { return d.toISOString().split("T")[0]; }

        function init() {
            document.getElementById("today").innerText = formatDate(new Date());

            if (settings.medLunch) medLunch.value = settings.medLunch;
            if (settings.medDinner) medDinner.value = settings.medDinner;
            if (settings.timeLunch) timeLunch.value = settings.timeLunch;
            if (settings.timeDinner) timeDinner.value = settings.timeDinner;
            if (settings.startDate) startDate.value = settings.startDate;

            const today = formatDate(new Date());
            if (!data[today]) data[today] = { lunch: false, dinner: false };

            checkLunch.checked = data[today].lunch;
            checkDinner.checked = data[today].dinner;

            checkLunch.onchange = () => {
                data[today].lunch = checkLunch.checked;
                localStorage.setItem(DATA_KEY, JSON.stringify(data));
                render();
            };

            checkDinner.onchange = () => {
                data[today].dinner = checkDinner.checked;
                localStorage.setItem(DATA_KEY, JSON.stringify(data));
                render();
            };

            render();
            setInterval(checkReminder, 60000);
        }

        function render() {
            history.innerHTML = "";
            Object.keys(data).sort().reverse().forEach(date => {
                history.innerHTML += `<tr>
<td>${date}</td>
<td>${data[date].lunch ? "✔" : ""}</td>
<td>${data[date].dinner ? "✔" : ""}</td>
</tr>`;
            });
        }

        function checkReminder() {
            const now = new Date();
            const current = now.toTimeString().slice(0, 5);
            if (current === settings.timeLunch && !data[formatDate(now)].lunch) {
                new Notification(settings.medLunch || "Lunch Medication");
            }
            if (current === settings.timeDinner && !data[formatDate(now)].dinner) {
                new Notification(settings.medDinner || "Dinner Medication");
            }
        }

        function requestNotif() {
            Notification.requestPermission();
        }

        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("sw.js");
        }

        init();
    </script>

</body>

</html>